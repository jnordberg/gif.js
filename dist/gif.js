(function(c){function a(b,d){if({}.hasOwnProperty.call(a.cache,b))return a.cache[b];var e=a.resolve(b);if(!e)throw new Error('Failed to resolve module '+b);var c={id:b,require:a,filename:b,exports:{},loaded:!1,parent:d,children:[]};d&&d.children.push(c);var f=b.slice(0,b.lastIndexOf('/')+1);return a.cache[b]=c.exports,e.call(c.exports,c,c.exports,f,b),c.loaded=!0,a.cache[b]=c.exports}a.modules={},a.cache={},a.resolve=function(b){return{}.hasOwnProperty.call(a.modules,b)?a.modules[b]:void 0},a.define=function(b,c){a.modules[b]=c};var b=function(a){return a='/',{title:'browser',version:'v0.10.5',browser:!0,env:{},argv:[],nextTick:c.setImmediate||function(a){setTimeout(a,0)},cwd:function(){return a},chdir:function(b){a=b}}}();a.define('/gif.coffee',function(b,h,i,j){function e(d,b){for(var a=0,c=b.length;a<c;++a)if(a in b&&b[a]===d)return!0;return!1}function f(a,b){return{}.hasOwnProperty.call(a,b)}function g(a,b){function d(){this.constructor=a}for(var c in b)f(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a}var c,d;c=a('events',b).EventEmitter,d=function(c,b){function a(d){var a,c;this.options=d,null==this.options&&(this.options={}),this.running=!1,this.images=[],this.freeWorkers=[],this.activeWorkers=[],this.canvas=document.createElement('canvas');for(a in b)c=b[a],null!=this.options[a]?this.options[a]:this.options[a]=c}return g(a,c),b={workerScript:'gif.worker.js',workers:2,repeat:0,background:'#fff',quality:10},a.prototype.setOption=function(a,b){return this.options[a]=b},a.prototype.setOptions=function(a){return function(c){var b,d;for(b in a)d=a[b],c.push(this.options[b]=d);return c}.call(this,[])},a.prototype.addImage=function(a,b,c){return null==b&&(b=1e3),null==c&&(c=[0,0]),this.images.push({image:a,delay:b,origin:c}),null!=this.size?void 0:this.setSize([a.width,a.height])},a.prototype.setSize=function(a){return this.size=a,this.canvas.width=this.size[0],this.canvas.height=this.size[1]},a.prototype.render=function(){var d,a;if(this.running)throw new Error('Already running');this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(b){var d;for(var a=0,c=function(){var b,b;b=[];for(var a=0;0<=this.images.length?a<this.images.length:a>this.images.length;0<=this.images.length?++a:--a)b.push(a);return b}.apply(this,arguments).length;a<c;++a)d=function(){var b,b;b=[];for(var a=0;0<=this.images.length?a<this.images.length:a>this.images.length;0<=this.images.length?++a:--a)b.push(a);return b}.apply(this,arguments)[a],b.push(null);return b}.call(this,[]),a=this.spawnWorkers();for(var b=0,c=function(){var c,c;c=[];for(var b=0;0<=a?b<a:b>a;0<=a?++b:--b)c.push(b);return c}.apply(this,arguments).length;b<c;++b)d=function(){var c,c;c=[];for(var b=0;0<=a?b<a:b>a;0<=a?++b:--b)c.push(b);return c}.apply(this,arguments)[b],this.renderNextFrame();return this.emit('start'),this.emit('progress',0)},a.prototype.abort=function(){var a;while(!0){if(a=this.activeWorkers.shift(),!(null!=a))break;console.log('killing active worker'),a.terminate()}return this.running=!1,this.emit('abort')},a.prototype.spawnWorkers=function(){var f,a,b,c;a=Math.min(this.options.workers,this.images.length);for(var d=0,e=function(){var c,c;c=[];for(var b=this.freeWorkers.length;this.freeWorkers.length<=a?b<a:b>a;this.freeWorkers.length<=a?++b:--b)c.push(b);return c}.apply(this,arguments).length;d<e;++d)f=function(){var c,c;c=[];for(var b=this.freeWorkers.length;this.freeWorkers.length<=a?b<a:b>a;this.freeWorkers.length<=a?++b:--b)c.push(b);return c}.apply(this,arguments)[d],console.log('spawning worker'),c=new Worker(this.options.workerScript),b=this,c.onmessage=function(a){return b.activeWorkers.splice(b.activeWorkers.indexOf(c),1),b.freeWorkers.push(c),b.frameFinished(a.data)},this.freeWorkers.push(c);return a},a.prototype.frameFinished=function(a){return console.log('frame '+a.index+' finished'),this.finishedFrames++,this.emit('progress',this.finishedFrames/this.images.length),this.imageParts[a.index]=a,e(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},a.prototype.finishRendering=function(){var g,a,k,m,b,d,h;b=0;for(var e=0,j=this.imageParts.length;e<j;++e)a=this.imageParts[e],b+=(a.data.length-1)*a.pageSize+a.cursor;b+=a.pageSize-a.cursor,console.log('rendering finished - filesize '+Math.round(b/1e3)+'kb'),g=new Uint8Array(b),d=0;for(var f=0,l=this.imageParts.length;f<l;++f){a=this.imageParts[f];for(var c=0,i=a.data.length;c<i;++c)h=a.data[c],k=c,g.set(h,d),k===a.data.length-1?d+=a.cursor:d+=a.pageSize}return m=new Blob([g],{type:'image/gif'}),this.emit('finished',m)},a.prototype.renderNextFrame=function(){var a,c,b;if(this.freeWorkers.length===0)throw new Error('Can not start next frame, no free workers!');return this.nextFrame>=this.images.length?void 0:(c=this.images[this.nextFrame++],b=this.freeWorkers.shift(),a=this.getFrame(c),console.log('starting frame '+(a.index+1)+' of '+this.images.length),this.activeWorkers.push(b),b.postMessage(a))},a.prototype.getFrame=function(a){var b,c,d;return d=this.images.indexOf(a),c={delay:a.delay,width:this.size[0],height:this.size[1],index:d,quality:this.options.quality,repeat:this.options.repeat,last:d===this.images.length-1},b=this.canvas.getContext('2d'),b.setFill=this.options.background,b.fillRect(0,0,this.size[0],this.size[1]),b.drawImage(a.image,a.origin[0],a.origin[1]),c.data=b.getImageData(0,0,this.size[0],this.size[1]).data,c},a}(c),b.exports=d}),a.define('events',function(f,e,g,h){b.EventEmitter||(b.EventEmitter=function(){});var a=e.EventEmitter=b.EventEmitter,c=typeof Array.isArray==='function'?Array.isArray:function(a){return Object.prototype.toString.call(a)==='[object Array]'},d=10;a.prototype.setMaxListeners=function(a){this._events||(this._events={}),this._events.maxListeners=a},a.prototype.emit=function(f){if(f==='error'&&(!(this._events&&this._events.error)||c(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var a=this._events[f];if(!a)return!1;if(!(typeof a=='function'))if(c(a)){var b=Array.prototype.slice.call(arguments,1),e=a.slice();for(var d=0,g=e.length;d<g;d++)e[d].apply(this,b);return!0}else return!1;switch(arguments.length){case 1:a.call(this);break;case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:var b=Array.prototype.slice.call(arguments,1);a.apply(this,b)}return!0},a.prototype.addListener=function(a,b){if('function'!==typeof b)throw new Error('addListener only takes instances of Function');if(this._events||(this._events={}),this.emit('newListener',a,b),!this._events[a])this._events[a]=b;else if(c(this._events[a])){if(!this._events[a].warned){var e;this._events.maxListeners!==undefined?e=this._events.maxListeners:e=d,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.',this._events[a].length),console.trace())}this._events[a].push(b)}else this._events[a]=[this._events[a],b];return this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(b,c){var a=this;return a.on(b,function d(){a.removeListener(b,d),c.apply(this,arguments)}),this},a.prototype.removeListener=function(a,d){if('function'!==typeof d)throw new Error('removeListener only takes instances of Function');if(!(this._events&&this._events[a]))return this;var b=this._events[a];if(c(b)){var e=b.indexOf(d);if(e<0)return this;b.splice(e,1),b.length==0&&delete this._events[a]}else this._events[a]===d&&delete this._events[a];return this},a.prototype.removeAllListeners=function(a){return a&&this._events&&this._events[a]&&(this._events[a]=null),this},a.prototype.listeners=function(a){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),c(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]}}),c.GIF=a('/gif.coffee')}.call(this,this))
/*
//@ sourceMappingURL=gif.js.map
*/
// gif.js 0.1.0 - https://github.com/jnordberg/gif.js
