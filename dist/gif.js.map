{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/events/events.js","src/browser.coffee","src/gif.coffee"],"names":["f","exports","module","define","amd","g","window","global","self","this","GIF","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","EventEmitter","_events","_maxListeners","undefined","prototype","defaultMaxListeners","setMaxListeners","isNumber","isNaN","TypeError","emit","type","er","handler","len","args","listeners","error","isObject","arguments","err","context","isUndefined","isFunction","Array","slice","apply","addListener","listener","m","newListener","push","warned","console","trace","on","once","fired","removeListener","list","position","splice","removeAllListeners","key","ret","listenerCount","evlistener","emitter","arg","UA","browser","mode","platform","ua","navigator","userAgent","toLowerCase","match","document","documentMode","name","version","parseFloat","parseInt","extend","child","parent","hasProp","ctor","constructor","__super__","superClass","defaults","frameDefaults","workerScript","workers","repeat","background","quality","width","height","transparent","debug","dither","delay","copy","dispose","left","top","options","base","value","running","frames","freeWorkers","activeWorkers","setOptions","setOption","_canvas","results","addFrame","image","frame","ref","ref1","canvas","ImageData","data","CanvasRenderingContext2D","WebGLRenderingContext","getContextData","childNodes","getImageData","render","j","numWorkers","nextFrame","finishedFrames","imageParts","spawnWorkers","globalPalette","renderNextFrame","abort","worker","shift","log","terminate","Math","min","forEach","_this","Worker","onmessage","event","indexOf","frameFinished","index","finishRendering","k","l","len1","len2","len3","offset","page","ref2","pageSize","cursor","round","Uint8Array","set","Blob","task","getTask","postMessage","ctx","createElement","getContext","fillStyle","fillRect","drawImage","globalOptions","last","canTransfer"],"mappings":"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","sourceRoot":"","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","### CoffeeScript version of the browser detection from MooTools ###\n\nua = navigator.userAgent.toLowerCase()\nplatform = navigator.platform.toLowerCase()\nUA = ua.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/) or [null, 'unknown', 0]\nmode = UA[1] == 'ie' && document.documentMode\n\nbrowser =\n  name: if UA[1] is 'version' then UA[3] else UA[1]\n  version: mode or parseFloat(if UA[1] is 'opera' && UA[4] then UA[4] else UA[2])\n\n  platform:\n    name: if ua.match(/ip(?:ad|od|hone)/) then 'ios' else (ua.match(/(?:webos|android)/) or platform.match(/mac|win|linux/) or ['other'])[0]\n\nbrowser[browser.name] = true\nbrowser[browser.name + parseInt(browser.version, 10)] = true\nbrowser.platform[browser.platform.name] = true\n\nmodule.exports = browser\n","{EventEmitter} = require 'events'\nbrowser = require './browser.coffee'\n\nclass GIF extends EventEmitter\n\n  defaults =\n    workerScript: 'gif.worker.js'\n    workers: 2\n    repeat: 0 # repeat forever, -1 = repeat once\n    background: '#fff'\n    quality: 10 # pixel sample interval, lower is better\n    width: null # size derermined from first frame if possible\n    height: null\n    transparent: null\n    debug: false\n    dither: false # see GIFEncoder.js for dithering options\n\n  frameDefaults =\n    delay: 500 # ms\n    copy: false\n    dispose: -1\n    left: 0\n    top: 0\n    width: null # size of the frame\n    height: null\n\n  constructor: (options) ->\n    super options\n    @running = false\n\n    @options = {}\n    @frames = []\n\n    @freeWorkers = []\n    @activeWorkers = []\n\n    @setOptions options\n    for key, value of defaults\n      @options[key] ?= value\n\n  setOption: (key, value) ->\n    @options[key] = value\n    if @_canvas? and key in ['width', 'height']\n      @_canvas[key] = value\n\n  setOptions: (options) ->\n    @setOption key, value for own key, value of options\n\n  addFrame: (image, options={}) ->\n    frame = {}\n    frame.transparent = @options.transparent\n    for key of frameDefaults\n      frame[key] = options[key] or frameDefaults[key]\n\n    # use the images width and height for options unless already set\n    @setOption 'width', (image.width || image.canvas?.width) unless @options.width?\n    @setOption 'height', (image.height || image.canvas?.height) unless @options.height?\n\n    if ImageData? and image instanceof ImageData\n       frame.data = image.data\n    else if (CanvasRenderingContext2D? and image instanceof CanvasRenderingContext2D) or (WebGLRenderingContext? and image instanceof WebGLRenderingContext)\n      if options.copy\n        frame.data = @getContextData image\n      else\n        frame.context = image\n    else if image.childNodes?\n      if options.copy\n        frame.data = @getImageData image\n      else\n        frame.image = image\n    else\n      throw new Error 'Invalid image'\n\n    @frames.push frame\n\n  render: ->\n    throw new Error 'Already running' if @running\n\n    if not @options.width? or not @options.height?\n      throw new Error 'Width and height must be set prior to rendering'\n\n    @running = true\n    @nextFrame = 0\n    @finishedFrames = 0\n\n    @imageParts = (null for i in [0...@frames.length])\n    numWorkers = @spawnWorkers()\n    # we need to wait for the palette\n    if @options.globalPalette == true\n      @renderNextFrame()\n    else\n      @renderNextFrame() for i in [0...numWorkers]\n\n    @emit 'start'\n    @emit 'progress', 0\n\n  abort: ->\n    loop\n      worker = @activeWorkers.shift()\n      break unless worker?\n      @log 'killing active worker'\n      worker.terminate()\n    @running = false\n    @emit 'abort'\n\n  # private\n\n  spawnWorkers: ->\n    numWorkers = Math.min(@options.workers, @frames.length)\n    [@freeWorkers.length...numWorkers].forEach (i) =>\n      @log \"spawning worker #{ i }\"\n      worker = new Worker @options.workerScript\n      worker.onmessage = (event) =>\n        @activeWorkers.splice @activeWorkers.indexOf(worker), 1\n        @freeWorkers.push worker\n        @frameFinished event.data\n      @freeWorkers.push worker\n    return numWorkers\n\n  frameFinished: (frame) ->\n    @log \"frame #{ frame.index } finished - #{ @activeWorkers.length } active\"\n    @finishedFrames++\n    @emit 'progress', @finishedFrames / @frames.length\n    @imageParts[frame.index] = frame\n    # remember calculated palette, spawn the rest of the workers\n    if @options.globalPalette == true\n      @options.globalPalette = frame.globalPalette\n      @log 'global palette analyzed'\n      @renderNextFrame() for i in [1...@freeWorkers.length] if @frames.length > 2\n    if null in @imageParts\n      @renderNextFrame()\n    else\n      @finishRendering()\n\n  finishRendering: ->\n    len = 0\n    for frame in @imageParts\n      len += (frame.data.length - 1) * frame.pageSize + frame.cursor\n    len += frame.pageSize - frame.cursor\n    @log \"rendering finished - filesize #{ Math.round(len / 1000) }kb\"\n    data = new Uint8Array len\n    offset = 0\n    for frame in @imageParts\n      for page, i in frame.data\n        data.set page, offset\n        if i is frame.data.length - 1\n          offset += frame.cursor\n        else\n          offset += frame.pageSize\n\n    image = new Blob [data],\n      type: 'image/gif'\n\n    @emit 'finished', image, data\n\n  renderNextFrame: ->\n    throw new Error 'No free workers' if @freeWorkers.length is 0\n    return if @nextFrame >= @frames.length # no new frame to render\n\n    frame = @frames[@nextFrame++]\n    worker = @freeWorkers.shift()\n    task = @getTask frame\n\n    @log \"starting frame #{ task.index + 1 } of #{ @frames.length }\"\n    @activeWorkers.push worker\n    worker.postMessage task#, [task.data.buffer]\n\n  getContextData: (ctx) ->\n    return ctx.getImageData(0, 0, @options.width, @options.height).data\n\n  getImageData: (image) ->\n    if not @_canvas?\n      @_canvas = document.createElement 'canvas'\n      @_canvas.width = @options.width\n      @_canvas.height = @options.height\n\n    ctx = @_canvas.getContext '2d'\n    ctx.fillStyle = @options.background\n    ctx.fillRect 0, 0, @options.width, @options.height\n    ctx.drawImage image, 0, 0\n\n    return @getContextData ctx\n\n  getTask: (frame) ->\n    index = @frames.indexOf frame\n    task =\n      globalOptions: @options\n      index: index\n      last: index is (@frames.length - 1)\n      delay: frame.delay\n      dispose: frame.dispose\n      transparent: frame.transparent\n      left: frame.left || 0\n      top: frame.top || 0\n      width: frame.width || @options.width\n      height: frame.height || @options.height\n      quality: @options.quality\n      dither: @options.dither\n      globalPalette: @options.globalPalette\n      repeat: @options.repeat\n      canTransfer: (browser.name is 'chrome')\n\n    if frame.data?\n      task.data = frame.data\n    else if frame.context?\n      task.data = @getContextData frame.context\n    else if frame.image?\n      task.data = @getImageData frame.image\n    else\n      throw new Error 'Invalid frame'\n\n    return task\n\n  log: (args...) ->\n    return unless @options.debug\n    console.log args...\n\n\nmodule.exports = GIF\n"]}