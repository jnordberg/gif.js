{"version":3,"file":true,"sources":["/gif.coffee","/browser.coffee","events"],"names":[],"mappings":"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","sourceRoot":"../src","sourcesContent":["{EventEmitter} = require 'events'\nbrowser = require './browser.coffee'\n\nclass GIF extends EventEmitter\n\n  defaults =\n    workerScript: 'gif.worker.js'\n    workers: 2\n    repeat: 0 # repeat forever, -1 = repeat once\n    background: '#fff'\n    quality: 10 # pixel sample interval, lower is better\n    width: null # size derermined from first frame if possible\n    height: null\n\n  frameDefaults =\n    delay: 500 # ms\n    copy: false\n\n  constructor: (options) ->\n    @running = false\n\n    @options = {}\n    @frames = []\n\n    @freeWorkers = []\n    @activeWorkers = []\n\n    @setOptions options\n    for key, value of defaults\n      @options[key] ?= value\n\n  setOption: (key, value) ->\n    @options[key] = value\n    if @_canvas? and key in ['width', 'height']\n      @_canvas[key] = value\n\n  setOptions: (options) ->\n    @setOption key, value for own key, value of options\n\n  addFrame: (image, options={}) ->\n    frame = {}\n    for key of frameDefaults\n      frame[key] = options[key] or frameDefaults[key]\n    if ImageData? and image instanceof ImageData\n       frame.data = image.data\n       frame.width = frame.witdh or image.width\n       frame.height = frame.height or image.height\n    else if (CanvasRenderingContext2D? and image instanceof CanvasRenderingContext2D) or (WebGLRenderingContext? and image instanceof WebGLRenderingContext)\n      if options.copy\n        frame.data = @getContextData image\n      else\n        frame.context = image\n    else if image.childNodes?\n      @setOption 'width', image.width unless @options.width?\n      @setOption 'height', image.height unless @options.height?\n      if options.copy\n        frame.data = @getImageData image\n      else\n        frame.image = image\n    else\n      throw new Error 'Invalid image'\n\n    @frames.push frame\n\n    @setOption 'width', frame.width if frame.width?\n    @setOption 'height', frame.height if frame.height?\n\n  render: ->\n    throw new Error 'Already running' if @running\n\n    @running = true\n    @nextFrame = 0\n    @finishedFrames = 0\n\n    @imageParts = (null for i in [0...@frames.length])\n    numWorkers = @spawnWorkers()\n    @renderNextFrame() for i in [0...numWorkers]\n\n    @emit 'start'\n    @emit 'progress', 0\n\n  abort: ->\n    loop\n      worker = @activeWorkers.shift()\n      break unless worker?\n      console.log \"killing active worker\"\n      worker.terminate()\n    @running = false\n    @emit 'abort'\n\n  # private\n\n  spawnWorkers: ->\n    numWorkers = Math.min(@options.workers, @frames.length)\n    for i in [@freeWorkers.length...numWorkers]\n      do (i) =>\n        console.log \"spawning worker #{ i }\"\n        worker = new Worker @options.workerScript\n        worker.onmessage = (event) =>\n          @activeWorkers.splice @activeWorkers.indexOf(worker), 1\n          @freeWorkers.push worker\n          @frameFinished event.data\n        @freeWorkers.push worker\n    return numWorkers\n\n  frameFinished: (frame) ->\n    console.log \"frame #{ frame.index } finished - #{ @activeWorkers.length } active\"\n    @finishedFrames++\n    @emit 'progress', @finishedFrames / @frames.length\n    @imageParts[frame.index] = frame\n    if null in @imageParts\n      @renderNextFrame()\n    else\n      @finishRendering()\n\n  finishRendering: ->\n    len = 0\n    for frame in @imageParts\n      len += (frame.data.length - 1) * frame.pageSize + frame.cursor\n    len += frame.pageSize - frame.cursor\n    console.log \"rendering finished - filesize #{ Math.round(len / 1000) }kb\"\n    data = new Uint8Array len\n    offset = 0\n    for frame in @imageParts\n      for page, i in frame.data\n        data.set page, offset\n        if i is frame.data.length - 1\n          offset += frame.cursor\n        else\n          offset += frame.pageSize\n\n    image = new Blob [data],\n      type: 'image/gif'\n\n    @emit 'finished', image, data\n\n  renderNextFrame: ->\n    throw new Error 'No free workers' if @freeWorkers.length is 0\n    return if @nextFrame >= @frames.length # no new frame to render\n\n    frame = @frames[@nextFrame++]\n    worker = @freeWorkers.shift()\n    task = @getTask frame\n\n    console.log \"starting frame #{ task.index + 1 } of #{ @frames.length }\"\n    @activeWorkers.push worker\n    worker.postMessage task#, [task.data.buffer]\n\n  getContextData: (ctx) ->\n    return ctx.getImageData(0, 0, @options.width, @options.height).data\n\n  getImageData: (image) ->\n    if not @_canvas?\n      @_canvas = document.createElement 'canvas'\n      @_canvas.width = @options.width\n      @_canvas.height = @options.height\n\n    ctx = @_canvas.getContext '2d'\n    ctx.setFill = @options.background\n    ctx.fillRect 0, 0, @options.width, @options.height\n    ctx.drawImage image, 0, 0\n\n    return @getContextData ctx\n\n  getTask: (frame) ->\n    index = @frames.indexOf frame\n    task =\n      index: index\n      last: index is (@frames.length - 1)\n      delay: frame.delay\n      width: @options.width\n      height: @options.height\n      quality: @options.quality\n      repeat: @options.repeat\n      canTransfer: (browser.name is 'chrome')\n\n    if frame.data?\n      task.data = frame.data\n    else if frame.context?\n      task.data = @getContextData frame.context\n    else if frame.image?\n      task.data = @getImageData frame.image\n    else\n      throw new Error 'Invalid frame'\n\n    return task\n\nmodule.exports = GIF\n","### CoffeeScript version of the browser detection from MooTools ###\n\nua = navigator.userAgent.toLowerCase()\nplatform = navigator.platform.toLowerCase()\nUA = ua.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/) or [null, 'unknown', 0]\nmode = UA[1] == 'ie' && document.documentMode\n\nbrowser =\n  name: if UA[1] is 'version' then UA[3] else UA[1]\n  version: mode or parseFloat(if UA[1] is 'opera' && UA[4] then UA[4] else UA[2])\n\n  platform:\n    name: if ua.match(/ip(?:ad|od|hone)/) then 'ios' else (ua.match(/(?:webos|android)/) or platform.match(/mac|win|linux/) or ['other'])[0]\n\nbrowser[browser.name] = true\nbrowser[browser.name + parseInt(browser.version, 10)] = true\nbrowser.platform[browser.platform.name] = true\n\nmodule.exports = browser\n","if (!process.EventEmitter) process.EventEmitter = function () {};\n\nvar EventEmitter = exports.EventEmitter = process.EventEmitter;\nvar isArray = typeof Array.isArray === 'function'\n    ? Array.isArray\n    : function (xs) {\n        return Object.prototype.toString.call(xs) === '[object Array]'\n    }\n;\n\n// By default EventEmitters will print a warning if more than\n// 10 listeners are added to it. This is a useful default which\n// helps finding memory leaks.\n//\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nvar defaultMaxListeners = 10;\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!this._events) this._events = {};\n  this._events.maxListeners = n;\n};\n\n\nEventEmitter.prototype.emit = function(type) {\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events || !this._events.error ||\n        (isArray(this._events.error) && !this._events.error.length))\n    {\n      if (arguments[1] instanceof Error) {\n        throw arguments[1]; // Unhandled 'error' event\n      } else {\n        throw new Error(\"Uncaught, unspecified 'error' event.\");\n      }\n      return false;\n    }\n  }\n\n  if (!this._events) return false;\n  var handler = this._events[type];\n  if (!handler) return false;\n\n  if (typeof handler == 'function') {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        var args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n    return true;\n\n  } else if (isArray(handler)) {\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    var listeners = handler.slice();\n    for (var i = 0, l = listeners.length; i < l; i++) {\n      listeners[i].apply(this, args);\n    }\n    return true;\n\n  } else {\n    return false;\n  }\n};\n\n// EventEmitter is defined in src/node_events.cc\n// EventEmitter.prototype.emit() is also defined there.\nEventEmitter.prototype.addListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('addListener only takes instances of Function');\n  }\n\n  if (!this._events) this._events = {};\n\n  // To avoid recursion in the case that type == \"newListeners\"! Before\n  // adding it to the listeners, first emit \"newListeners\".\n  this.emit('newListener', type, listener);\n\n  if (!this._events[type]) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  } else if (isArray(this._events[type])) {\n\n    // Check for listener leak\n    if (!this._events[type].warned) {\n      var m;\n      if (this._events.maxListeners !== undefined) {\n        m = this._events.maxListeners;\n      } else {\n        m = defaultMaxListeners;\n      }\n\n      if (m && m > 0 && this._events[type].length > m) {\n        this._events[type].warned = true;\n        console.error('(node) warning: possible EventEmitter memory ' +\n                      'leak detected. %d listeners added. ' +\n                      'Use emitter.setMaxListeners() to increase limit.',\n                      this._events[type].length);\n        console.trace();\n      }\n    }\n\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  } else {\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  var self = this;\n  self.on(type, function g() {\n    self.removeListener(type, g);\n    listener.apply(this, arguments);\n  });\n\n  return this;\n};\n\nEventEmitter.prototype.removeListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('removeListener only takes instances of Function');\n  }\n\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (!this._events || !this._events[type]) return this;\n\n  var list = this._events[type];\n\n  if (isArray(list)) {\n    var i = list.indexOf(listener);\n    if (i < 0) return this;\n    list.splice(i, 1);\n    if (list.length == 0)\n      delete this._events[type];\n  } else if (this._events[type] === listener) {\n    delete this._events[type];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (type && this._events && this._events[type]) this._events[type] = null;\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  if (!this._events) this._events = {};\n  if (!this._events[type]) this._events[type] = [];\n  if (!isArray(this._events[type])) {\n    this._events[type] = [this._events[type]];\n  }\n  return this._events[type];\n};\n"]}